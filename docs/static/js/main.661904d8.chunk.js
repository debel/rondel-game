(this["webpackJsonprondel-game"]=this["webpackJsonprondel-game"]||[]).push([[0],{13:function(t,e,n){},15:function(t,e,n){},16:function(t,e,n){"use strict";n.r(e);var r=n(0),o=n.n(r),c=n(5),i=n.n(c),a=(n(13),n(2)),u=n(1),s=n.n(u),l=n(3),f=n(6),d=["sushi","noodles","tea"],p=function(){return d[Math.floor(3*Math.random())]},v=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6,r=Math.floor(Math.random()*(n-1))+e;return Array.from(new Array(r),p).reduce((function(t,e){return t.foods[e]||(t.foods[e]=0),t.foods[e]+=1,t}),{id:t,foods:{},points:2*(r-1)-1,money:Math.min(r-1,4)})},h=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];var t=Array.from(new Array(3),(function(t,e){return v(e)}));return{currentOrders:function(){return Object(f.a)(t).filter((function(t){return t}))},discardOrder:function(e){delete t[e],t[t.length]=v(t.length)}}},m=h(),y=function(t,e){return Object.entries(e.foods).map((function(e){var n=Object(a.a)(e,2),r=n[0],o=n[1];return t[r]>=o})).every((function(t){return!0===t}))},b=function(t){return function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Promise.resolve(e.gainFood(t,n))}},w=function(t,e,n){return s.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",e.selectAction(n.map((function(n){return Object(l.a)({},n,{action:function(){return n.action().catch((function(n){return alert(n),t.activate(e)}))}})}))));case 1:case"end":return r.stop()}}))},g=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return n.selectFood(!1).then((function(o){var c=o.foodType;o.amount;return c===t?(alert("Cannot make ".concat(t," here")),e.activate(n,r)):n.gainFood(c,r)}))},E=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t.selectFood().then((function(n){var r=n.foodType,o=n.amount;return t.loseFood(r,o).then((function(){return t.gainMoney(o*e)}))}))},O={icon:"",title:"",description:"",type:0,cost:0,position:"x",activate:function(t,e){}},S=[{icon:"\ud83c\udf75 / \ud83c\udf5c",title:"Tea or Noodles",description:"make either tea or noodles",type:1,cost:3,activate:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return g("sushi",this,t,e)}},{icon:"\ud83c\udf75 / \ud83c\udf63",title:"Tea or Sushi",description:"make either tea or sushi",type:1,cost:3,activate:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return g("noodles",this,t,e)}},{icon:"\ud83c\udf63 / \ud83c\udf5c",title:"Sushi or Noodles",description:"make either sushi or noodles",type:1,cost:3,activate:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return g("tea",this,t,e)}},{icon:"\ud83e\udd61\ud83e\udd61",title:"Sell 2 food",description:"sell 2 food",type:2,cost:4,activate:function(t){var e=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return E(t,n).then((function(){return E(t,n)})).catch((function(n){return e.activate(t)}))}},{icon:"\ud83d\udee0\ufe0f / \ud83d\udc69\u200d\ud83c\udf73",title:"",description:"",type:2,cost:5,activate:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];return w(this,t,[{icon:"\ud83d\udee0\ufe0f",action:function(){return k[5].activate(t)}},{icon:"\ud83d\udc69\u200d\ud83c\udf73",action:function(){return k[4].activate(t)}}])}},{icon:"\ud83d\udee0\ufe0f\ud83e\udde9",title:"",description:"",type:3,cost:6,activate:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];return k[5].activate(t).catch((function(t){alert(t)})).then((function(){return k[7].activate(t)}))}},{icon:"\ud83e\udd61\ud83d\udee0\ufe0f",title:"",description:"",type:3,cost:6,activate:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];return k[3].activate(t).catch((function(t){alert(t)})).then((function(){return k[5].activate(t)}))}},{icon:"\ud83e\udd61 / \ud83c\udf7d\ufe0f",title:"Sell or Dine",description:"discard food for money or fulfil an order",type:3,cost:7,activate:function(t){arguments.length>1&&void 0!==arguments[1]&&arguments[1];return w(this,t,[{icon:"\ud83c\udf7d\ufe0f",action:function(){return k[6].activate(t)}},{icon:"\ud83e\udd61",action:function(){return k[3].activate(t)}}])}},{icon:"\ud83c\udf63\ud83c\udf5c\ud83c\udf75",title:"",description:"",type:3,cost:9,activate:function(t){var e=arguments;return s.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:e.length>1&&void 0!==e[1]?e[1]:1,b("sushi")(t),b("noodles")(t),b("tea")(t);case 4:case"end":return n.stop()}}))}}],k=[{icon:"\ud83c\udf63",title:"Sushi",description:"Cook some sushi",type:0,cost:0,activate:b("sushi")},{icon:"\ud83c\udf5c",title:"Noodles",description:"Cook some noodles",type:0,cost:0,activate:b("noodles")},{icon:"\ud83c\udf75",title:"Tea",description:"Produce some tea",type:0,cost:0,activate:b("tea")},{icon:"\ud83e\udd61",title:"Takeout",description:"Sell food for money",type:0,cost:0,activate:function(t){var e,n=this,r=arguments;return s.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:if(e=r.length>1&&void 0!==r[1]?r[1]:1,t.hasAnyFood()){o.next=3;break}throw new Error("no food to sell");case 3:return o.abrupt("return",t.selectFood().then((function(r){var o=r.foodType,c=r.amount;return t.loseFood(o,c).then((function(){return t.gainMoney(c*e)})).catch((function(e){return alert(e),n.activate(t)}))})));case 4:case"end":return o.stop()}}))}},{icon:"\ud83d\udc69\u200d\ud83c\udf73",title:"Hire",description:"Hire a worker (new meeple)",type:0,cost:0,activate:function(t,e){return s.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return alert("hire"),t.abrupt("return",!0);case 2:case"end":return t.stop()}}))}},{icon:"\ud83d\udee0\ufe0f",title:"Improve",description:"Improve your restaurant (buy tiles)",type:0,cost:0,activate:function(t,e){var n=this;return s.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:if(S.map((function(e){return t.currentMoney()>=e.cost})).some((function(t){return!0===t}))){e.next=3;break}throw new Error("cannot afford any tiles");case 3:return e.abrupt("return",t.selectTile().then((function(e){return t.loseMoney(e.cost).then((function(){return t.placeTile(e)}),(function(e){return alert(e),n.activate(t)}))})));case 4:case"end":return e.stop()}}))}},{icon:"\ud83c\udf7d\ufe0f",title:"Dining",description:"Fulfil an order",type:0,cost:0,activate:function(t){var e=this,n=arguments;return s.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:if(n.length>1&&void 0!==n[1]?n[1]:1,m.currentOrders().map((function(e){return y(t.currentFood(),e)})).some((function(t){return!0===t}))){r.next=4;break}throw new Error("Cannot fulfil any orders right now");case 4:return r.abrupt("return",t.selectOrder().then((function(e){return t.fulfilOrder(e)}),alert).catch((function(n){return alert(n),e.activate(t)})));case 5:case"end":return r.stop()}}))}},{icon:"\ud83e\udde9",name:"Rearrange",text:"Rearrange tiles on your board",type:0,cost:0,activate:function(t,e){return s.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.selectPosition().then((function(e){return t.selectPosition().then((function(n){return t.swapTiles(e,n)}))})));case 1:case"end":return e.stop()}}))}}],x=k,j="food",F="tile",M="position",T="order",P="action",A=function(){var t=function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,e=Array.from(new Array(t),(function(t,e){return e})),n=[],r=0;r<t;r+=1){var o=Math.floor(Math.random()*e.length),c=e.splice(o,1)[0];n.push(c)}return n}(x.length).map((function(t,e){return Object(l.a)({},x[t],{position:e})}));return t.x=O,t},C=function(t,e,n){var r=A(),o={},c={sushi:0,noodles:0,tea:0},i=0,u=0,f=0,d=0,p=null,v=function(){},h=function(){},m=null,b=function(t,e){return new Promise((function(n,r){p=t,v({type:t,options:e}),m=function(t){return p=null,m=null,v(null),n(t)}}))};return{onSetState:function(t){v=t},gainMoney:function(t){f+=t},loseMoney:function(t){return s.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(f<t)){e.next=2;break}throw new Error("Not enough money");case 2:f-=t;case 3:case"end":return e.stop()}}))},gainPoints:function(t){d+=t},gainFood:function(t,e){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];c[t]||(c[t]=0),n&&o.gainFood&&o.gainFood.call(this,t,e),c[t]+=e,i+=e},loseFood:function(t,e){return s.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:if(c[t]&&!(c[t]<e)){n.next=2;break}throw new Error("Not enough ".concat(t));case 2:c[t]-=e,i-=e;case 4:case"end":return n.stop()}}))},hasAnyFood:function(){return i>0},selectFood:function(){return b(j)},currentMoney:function(){return f},currentScore:function(){return d},currentFood:function(){return Object(l.a)({},c)},currentBoard:function(){return r},currentPosition:function(){return u},onMove:function(t){h=t},move:function(t){var e=this;if(p)throw new Error("select ".concat(p," first"));if(u<6&&u<t&&t-u<=2||6===u&&(7===t||0===t)||7===u&&(0===t||1===t))return u=t,Promise.resolve().then((function(){return r[t].activate(e)})).finally(h);throw new Error("Illigal move")},selectOrder:function(){return s.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",b(T));case 1:case"end":return t.stop()}}))},fulfilOrder:function(t){var n,r=this;return s.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:if(n=Object.entries(t.foods),y(c,t)){o.next=4;break}throw p=null,new Error("Cannot fulfil order");case 4:n.forEach((function(t){var e=Object(a.a)(t,2),n=e[0],o=e[1];r.loseFood(n,o)})),e.discardOrder(t.id),this.gainPoints(t.points),this.gainMoney(t.money),p=null;case 9:case"end":return o.stop()}}),null,this)},selectPosition:function(){return s.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",b(M).then((function(t){if("x"===t)throw new Error("cannot select the centeral square");return t})));case 1:case"end":return t.stop()}}))},swapTiles:function(t,e){var n,o;return s.a.async((function(c){for(;;)switch(c.prev=c.next){case 0:n=r[t],o=r[e],n.position=e,o.position=t,r[t]=o,r[e]=n;case 6:case"end":return c.stop()}}))},selectTile:function(){return s.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",b(F));case 1:case"end":return t.stop()}}))},placeTile:function(t){return s.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",b(M).then((function(e){r[e]=Object(l.a)({},t,{position:e}),v(void 0)})));case 1:case"end":return e.stop()}}))},uiSelection:function(t,e){return m(e)},selectAction:function(t){return b(P,t)}}},N={money:{symbol:"\ud83d\udcb8"},points:{symbol:"\u2b50"},sushi:{symbol:"\ud83c\udf63",type:"food"},noodles:{symbol:"\ud83c\udf5c",type:"food"},tea:{symbol:"\ud83c\udf75",type:"food"}},B=function(t){var e=Object.entries(Object(l.a)({money:t.player.currentMoney(),points:t.player.currentScore()},t.player.currentFood())).reduce((function(e,n){var r=Object(a.a)(n,2),c=r[0],i=r[1];e[i]||(e[i]=[]);var u="food"===N[c].type?o.a.createElement("div",{onClick:function(){return t.onSelectFood&&t.onSelectFood({foodType:c,amount:1})}},N[c].symbol):o.a.createElement("div",null,N[c].symbol);return e[i].push(u),e}),Array.from(new Array(11)));return o.a.createElement("table",{class:"player-stats"},o.a.createElement("tr",null,Object.keys(e).map((function(t){return o.a.createElement("td",null,e[t]||[])}))),o.a.createElement("tr",null,Object.keys(e).map((function(t){return o.a.createElement("td",null,t)}))))},I=function(t){var e=t.id,n=t.foods,r=t.points,c=t.onSelect,i=t.money;return o.a.createElement("div",{class:"order",onClick:function(){return c&&c({id:e,foods:n,points:r,money:i})}},Object.entries(n).map((function(t){var e=Object(a.a)(t,2),n=e[0],r=e[1];return o.a.createElement("span",null,r," ",N[n].symbol)})),o.a.createElement("hr",null),o.a.createElement("div",null,r," ",N.points.symbol,"  ",i," ",N.money.symbol))},R=function(t){var e=t.onSelect;return o.a.createElement("div",null,m.currentOrders().map((function(t){return o.a.createElement(I,Object.assign({},t,{onSelect:e}))})))},D=n(7),H=function(t){var e=t.icon,n=t.cost,r=t.description,c=t.onSelect,i=Object(D.a)(t,["icon","cost","description","onSelect"]);return o.a.createElement("td",{class:"market-tile",onClick:function(){return c&&c(Object(l.a)({icon:e,cost:n},i))}},e,o.a.createElement("hr",null),o.a.createElement("div",null,"cost: ",n,"\ud83d\udcb8"),o.a.createElement("div",{class:"tooltip"},r))},J=function(t){var e=t.onSelect;return o.a.createElement("table",{className:"tiles-market small-font"},S.reduce((function(t,e,n){var r=e.type||1;return t[r]||(t[r]=[]),t[r].push(e),t}),[]).map((function(t){return o.a.createElement("tr",null,t.map((function(t){return o.a.createElement(H,Object.assign({},t,{onSelect:e}))})))})))},W=function(t){return o.a.createElement("table",{class:"player-board"},function(t){return[[t[0],t[1],t[2]],[t[7],t.x,t[3]],[t[6],t[5],t[4]]]}(t.player.currentBoard()).map((function(e){return o.a.createElement("tr",null,e.map((function(e){return o.a.createElement("td",{class:"board-tile",onClick:function(){return Promise.resolve().then((function(){return t.onPlaceTile?t.onPlaceTile(e.position):t.player.move(e.position)})).catch(alert)}},e.icon," ",t.player.currentPosition()===e.position?"\u265f\ufe0f":"",o.a.createElement("div",{class:"tooltip"},e.description))})))})))},q=(n(15),C("p1",m,S)),$=function(t){var e=t.options,n=t.forceRefresh;return e&&o.a.createElement("div",{class:"action-options"},e.map((function(t){return o.a.createElement("div",{class:"action-option",onClick:function(){return t.action().then(n)}},t.icon)})))};var z=function(){var t=o.a.useState(0),e=Object(a.a)(t,2),n=e[0],c=e[1],i=o.a.useState(0),u=Object(a.a)(i,2),s=(u[0],u[1]),l=o.a.useState(null),f=Object(a.a)(l,2),d=f[0],p=f[1],v=o.a.useState(null),h=Object(a.a)(v,2),m=h[0],y=h[1],b=function(t){return d&&d===t?function(e){return q.uiSelection(t,e)}:null};return Object(r.useEffect)((function(){q.onMove((function(){return c((function(t){return t+1}))})),q.onSetState((function(t){var e=t||{},n=e.type,r=void 0===n?null:n,o=e.options,c=void 0===o?null:o;p(r),y(c)}))}),[]),o.a.createElement("div",{class:"wrapper"},o.a.createElement("div",null,"Turn: ",n," ",d?"Select ".concat(d):""),o.a.createElement($,{options:m,forceRefresh:function(){return s((function(t){return t+1}))}}),o.a.createElement("div",{class:"float-left"},o.a.createElement(W,{player:q,onPlaceTile:b(M)}),o.a.createElement(B,{player:q,onSelectFood:b(j)})),o.a.createElement("div",{class:"float-right"},o.a.createElement(R,{onSelect:b(T)}),o.a.createElement(J,{onSelect:b(F)})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(z,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()}))},8:function(t,e,n){t.exports=n(16)}},[[8,1,2]]]);
//# sourceMappingURL=main.661904d8.chunk.js.map