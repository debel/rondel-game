(this["webpackJsonprondel-game"]=this["webpackJsonprondel-game"]||[]).push([[0],{13:function(e,t,n){},15:function(e,t,n){},16:function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),i=n(5),c=n.n(i),a=(n(13),n(7)),u=n(1),l=n(2),s=n(3),f=n.n(s),d=function(e){return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Promise.resolve(t.gainFood(e,n))}},h=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return n.selectFood(!1).then((function(o){var i=o.foodType;o.amount;return i===e?(alert("Cannot make ".concat(e," here")),t.activate(n,r)):n.gainFood(i,r)}))},m=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e.selectFood().then((function(n){var r=n.foodType,o=n.amount;return e.loseFood(r,o).then((function(){return e.gainMoney(o*t)}))}))},v=[{icon:"\ud83c\udf63",title:"Sushi",description:"Cook some sushi",type:0,cost:0,activate:d("sushi")},{icon:"\ud83c\udf5c",title:"Noodles",description:"Cook some noodles",type:0,cost:0,activate:d("noodles")},{icon:"\ud83c\udf75",title:"Tea",description:"Produce some tea",type:0,cost:0,activate:d("tea")},{icon:"\ud83e\udd61",title:"Takeout",description:"Sell food for money",type:0,cost:0,activate:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e.selectFood().then((function(r){var o=r.foodType,i=r.amount;return e.loseFood(o,i).then((function(){return e.gainMoney(i*n)})).catch((function(n){return alert(n),t.activate(e)}))}))}},{icon:"\ud83d\udc69\u200d\ud83c\udf73",title:"Hire",description:"Hire a worker (new meeple)",type:0,cost:0,activate:function(e,t){}},{icon:"\ud83d\udee0\ufe0f",title:"Improve",description:"Improve your restaurant (buy tiles)",type:0,cost:0,activate:function(e,t){var n=this;return e.selectTile().then((function(t){return e.placeTile(t)}),alert).catch((function(t){return alert(t),n.activate(e)}))}},{icon:"\ud83c\udf7d\ufe0f",title:"Dining",description:"Get points for food",type:0,cost:0,activate:function(e){var t=this;arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e.selectOrder().then((function(t){return e.fulfilOrder(t)}),alert).catch((function(n){return alert(n),t.activate(e)}))}},{icon:"\ud83e\udde9",name:"Rearrange",text:"Rearrange tiles on your board",type:0,cost:0,activate:function(e,t){}}],p={icon:"",title:"",description:"",type:0,cost:0,position:"x",activate:function(e,t){}},y=[{icon:"\ud83c\udf75 / \ud83c\udf5c",title:"Tea or Noodles",description:"make either tea or noodles",type:1,cost:2,activate:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return h("sushi",this,e,t)}},{icon:"\ud83c\udf75 / \ud83c\udf63",title:"Tea or Sushi",description:"make either tea or sushi",type:1,cost:2,activate:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return h("noodles",this,e,t)}},{icon:"\ud83c\udf63 / \ud83c\udf5c",title:"Sushi or Noodles",description:"make either sushi or noodles",type:1,cost:2,activate:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return h("tea",this,e,t)}},{icon:"\ud83e\udd61 / \ud83c\udf7d\ufe0f",title:"Sell or Dine",description:"discard food for money or fulfil an order",type:1,cost:4,activate:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1]}},{icon:"\ud83e\udd61\ud83e\udd61",title:"Sell 2 food",description:"sell 2 food",type:1,cost:3,activate:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return m(e,n).then((function(){return m(e,n)})).catch((function(n){return t.activate(e)}))}}],b=v;p.icon="\ud83c\udf75 + 1";var w=function(){var e=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,t=Array.from(new Array(e),(function(e,t){return t})),n=[],r=0;r<e;r+=1){var o=Math.floor(Math.random()*t.length),i=t.splice(o,1)[0];n.push(i)}return n}(b.length).map((function(e,t){return Object(l.a)({},b[e],{position:t})}));return e.x=p,e},g=function(e,t){return Object.entries(t.foods).map((function(t){var n=Object(u.a)(t,2),r=n[0],o=n[1];return e[r]>=o})).every((function(e){return!0===e}))},E=function(e,t,n){var r=w(),o={gainFood:function(e,t){"tea"===e&&this.gainFood("tea",1,!1)}},i={sushi:0,noodles:0,tea:0},c=0,a=0,s=0,d=function(){return Promise.resolve()},h=function(){return Promise.resolve()},m=function(){return Promise.resolve()},v=function(){return Promise.resolve()},p=function(){},y=null;return{allowSelectFood:function(e){d=e},allowSelectOrder:function(e){h=e},allowSelectTile:function(e){m=e},allowPlaceTile:function(e){v=e},gainMoney:function(e){a+=e},loseMoney:function(e){return f.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(a<e)){t.next=2;break}throw new Error("Not enough money");case 2:a-=e;case 3:case"end":return t.stop()}}))},gainPoints:function(e){s+=e},gainFood:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];i[e]||(i[e]=0),n&&o.gainFood&&o.gainFood.call(this,e,t),i[e]+=t},loseFood:function(e,t){return f.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:if(i[e]&&!(i[e]<t)){n.next=2;break}throw new Error("Not enough ".concat(e));case 2:i[e]-=t;case 3:case"end":return n.stop()}}))},selectFood:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(y)throw new Error("already selecting ".concat(y));var t=Object.entries(i).reduce((function(e,t){var n=Object(u.a)(t,2);n[0];return e+n[1]}),0);if(e&&0===t)throw new Error("Not enough food");return y="food",d().finally((function(){y=null}))},currentMoney:function(){return a},currentScore:function(){return s},currentFood:function(){return Object(l.a)({},i)},currentBoard:function(){return r},getPosition:function(){return c},onMove:function(e){p=e},move:function(e){var t=this;if(y)throw new Error("select ".concat(y," first"));if(c<6&&c<e&&e-c<=2||6===c&&(7===e||0===e)||7===c&&(0===e||1===e))return c=e,Promise.resolve().then((function(){return r[e].activate(t)})).finally(p);throw new Error("Illigal move")},selectOrder:function(e){return f.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:if(!y){e.next=2;break}throw new Error("already selecting ".concat(y));case 2:if(t.currentOrders().map((function(e){return g(i,e)})).some((function(e){return!0===e}))){e.next=6;break}throw new Error("Cannot fulfil any orders right now");case 6:return e.abrupt("return",h());case 7:case"end":return e.stop()}}))},fulfilOrder:function(e){var n,r=this;return f.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:if(n=Object.entries(e.foods),g(i,e)){o.next=3;break}throw new Error("Cannot fulfil order");case 3:n.forEach((function(e){var t=Object(u.a)(e,2),n=t[0],o=t[1];r.loseFood(n,o)})),t.discardOrder(e.id),this.gainPoints(e.points),this.gainMoney(e.money);case 7:case"end":return o.stop()}}),null,this)},selectTile:function(){return f.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:if(!y){e.next=2;break}throw new Error("already selecting ".concat(y));case 2:if(n.map((function(e){return a>=e.cost})).some((function(e){return!0===e}))){e.next=6;break}throw new Error("cannot afford any tiles");case 6:return y=!0,e.abrupt("return",m());case 8:case"end":return e.stop()}}))},placeTile:function(e){return f.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.loseMoney(e.cost).then(v).then((function(t){r[t]=Object(l.a)({},e,{position:t})})).finally((function(){y=!1})));case 1:case"end":return t.stop()}}),null,this)}}},O=n(6),S=["sushi","noodles","tea"],j=function(){return S[Math.floor(3*Math.random())]},k=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6,r=Math.floor(Math.random()*(n-1))+t;return Array.from(new Array(r),j).reduce((function(e,t){return e.foods[t]||(e.foods[t]=0),e.foods[t]+=1,e}),{id:e,foods:{},points:2*(r-1)-1,money:Math.min(r-1,4)})},P=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];var e=Array.from(new Array(3),(function(e,t){return k(t)}));return{currentOrders:function(){return Object(O.a)(e).filter((function(e){return e}))},discardOrder:function(t){delete e[t],e[e.length]=k(e.length)}}},F=(n(15),function(e){return o.a.createElement("table",{class:"player-board"},function(e){return[[e[0],e[1],e[2]],[e[7],e.x,e[3]],[e[6],e[5],e[4]]]}(e.player.currentBoard()).map((function(t){return o.a.createElement("tr",null,t.map((function(t){return o.a.createElement("td",{onClick:function(){return Promise.resolve().then((function(){return e.onPlaceTile?e.onPlaceTile(t.position):e.player.move(t.position)})).catch(alert)}},t.icon," ",e.player.getPosition()===t.position?"\u265f\ufe0f":"")})))})))}),T={money:{symbol:"\ud83d\udcb8"},points:{symbol:"\u2b50"},sushi:{symbol:"\ud83c\udf63",type:"food"},noodles:{symbol:"\ud83c\udf5c",type:"food"},tea:{symbol:"\ud83c\udf75",type:"food"}},x=function(e){var t=Object.entries(Object(l.a)({money:e.player.currentMoney(),points:e.player.currentScore()},e.player.currentFood())).reduce((function(t,n){var r=Object(u.a)(n,2),i=r[0],c=r[1];t[c]||(t[c]=[]);var a="food"===T[i].type?o.a.createElement("div",{onClick:function(){return e.onSelectFood(i)}},T[i].symbol):o.a.createElement("div",null,T[i].symbol);return t[c].push(a),t}),Array.from(new Array(11)));return o.a.createElement("table",{class:"player-stats"},o.a.createElement("tr",null,Object.keys(t).map((function(e){return o.a.createElement("td",null,t[e]||[])}))),o.a.createElement("tr",null,Object.keys(t).map((function(e){return o.a.createElement("td",null,e)}))))},M=P(),C=E("p1",M,y),A=function(e){var t=e.id,n=e.foods,r=e.points,i=e.onSelect,c=e.money;return o.a.createElement("div",{class:"order",onClick:function(){return i({id:t,foods:n,points:r,money:c})}},Object.entries(n).map((function(e){var t=Object(u.a)(e,2),n=t[0],r=t[1];return o.a.createElement("span",null,r," ",T[n].symbol)})),o.a.createElement("div",null,r," ",T.points.symbol,"  ",c," ",T.money.symbol))},N=function(e){return o.a.createElement("div",null,e.orders.map((function(t){return o.a.createElement(A,Object.assign({},t,{onSelect:e.onSelectOrder}))})))},B=function(e){var t=e.icon,n=e.cost,r=e.description,i=e.onSelect,c=Object(a.a)(e,["icon","cost","description","onSelect"]);return o.a.createElement("td",{onClick:function(){return i(Object(l.a)({icon:t,cost:n},c))}},t," ",o.a.createElement("div",null,"cost: ",n,"\ud83d\udcb8"),o.a.createElement("div",{class:"tooltip"},r))},I=function(e){var t=e.onSelect;return o.a.createElement("table",{className:"player-board small-font"},o.a.createElement("tr",null,y.map((function(e){return o.a.createElement(B,Object.assign({},e,{onSelect:t}))}))))};var D=function(){var e=o.a.useState(0),t=Object(u.a)(e,2),n=t[0],r=t[1],i=o.a.useState(!0),c=Object(u.a)(i,2),a=(c[0],c[1]),l=o.a.useState(""),s=Object(u.a)(l,2),f=s[0],d=s[1],h=o.a.useState((function(){return function(){}})),m=Object(u.a)(h,2),v=m[0],p=m[1],y=o.a.useState((function(){return function(){}})),b=Object(u.a)(y,2),w=b[0],g=b[1],E=o.a.useState((function(){return function(){}})),O=Object(u.a)(E,2),S=O[0],j=O[1],k=o.a.useState(null),P=Object(u.a)(k,2),T=P[0],A=P[1];return C.onMove((function(){return r((function(e){return e+1}))})),C.allowSelectFood((function(){return new Promise((function(e,t){a(!1),p((function(){return function(t){return e({foodType:t,amount:1})}})),d("Select food")})).finally((function(){a(!0),p((function(){return function(){}})),d("")}))})),C.allowSelectOrder((function(){return new Promise((function(e,t){a(!1),g((function(){return function(t){return e(t)}})),d("Select order")})).finally((function(){a(!0),g((function(){return function(){}})),d("")}))})),C.allowSelectTile((function(){return new Promise((function(e,t){a(!1),j((function(){return function(t){return e(t)}})),d("Select a tile from the market")})).finally((function(){a(!0),j((function(){return function(){}})),d("")}))})),C.allowPlaceTile((function(){return new Promise((function(e,t){a(!1),A((function(){return function(t){return e(t)}})),d("Place the tile on your board")})).finally((function(){a(!0),A(null),d("")}))})),o.a.createElement("div",{class:"wrapper"},o.a.createElement("div",null,"Turn: ",n," ",f),o.a.createElement(F,{player:C,refresh:function(){r((function(e){return e+1}))},onPlaceTile:T}),o.a.createElement("div",{class:"float-right"},o.a.createElement(N,{orders:M.currentOrders(),onSelectOrder:w}),o.a.createElement(x,{player:C,onSelectFood:v}),o.a.createElement(I,{onSelect:S})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(o.a.createElement(D,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},8:function(e,t,n){e.exports=n(16)}},[[8,1,2]]]);
//# sourceMappingURL=main.ccc8342d.chunk.js.map