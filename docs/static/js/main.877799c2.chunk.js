(this["webpackJsonprondel-game"]=this["webpackJsonprondel-game"]||[]).push([[0],{13:function(e,t,n){},15:function(e,t,n){},16:function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),c=n(5),a=n.n(c),i=(n(13),n(7)),u=n(2),s=n(3),l=n(1),f=n.n(l),d=n(6),p=["sushi","noodles","tea"],v=function(){return p[Math.floor(3*Math.random())]},h=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6,r=Math.floor(Math.random()*(n-1))+t;return Array.from(new Array(r),v).reduce((function(e,t){return e.foods[t]||(e.foods[t]=0),e.foods[t]+=1,e}),{id:e,foods:{},points:2*(r-1)-1,money:Math.min(r-1,4)})},m=function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];var e=Array.from(new Array(3),(function(e,t){return h(t)}));return{currentOrders:function(){return Object(d.a)(e).filter((function(e){return e}))},discardOrder:function(t){delete e[t],e[e.length]=h(e.length)}}},y=m(),b=function(e,t){return Object.entries(t.foods).map((function(t){var n=Object(u.a)(t,2),r=n[0],o=n[1];return e[r]>=o})).every((function(e){return!0===e}))},E=function(e){return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return Promise.resolve(t.gainFood(e,n))}},g=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return n.selectFood(!1).then((function(o){var c=o.foodType;o.amount;return c===e?(alert("Cannot make ".concat(e," here")),t.activate(n,r)):n.gainFood(c,r)}))},w=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e.selectFood().then((function(n){var r=n.foodType,o=n.amount;return e.loseFood(r,o).then((function(){return e.gainMoney(o*t)}))}))},O={icon:"",title:"",description:"",type:0,cost:0,position:"x",activate:function(e,t){}},S=[{icon:"\ud83c\udf75 / \ud83c\udf5c",title:"Tea or Noodles",description:"make either tea or noodles",type:1,cost:2,activate:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return g("sushi",this,e,t)}},{icon:"\ud83c\udf75 / \ud83c\udf63",title:"Tea or Sushi",description:"make either tea or sushi",type:1,cost:2,activate:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return g("noodles",this,e,t)}},{icon:"\ud83c\udf63 / \ud83c\udf5c",title:"Sushi or Noodles",description:"make either sushi or noodles",type:1,cost:2,activate:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return g("tea",this,e,t)}},{icon:"\ud83e\udd61 / \ud83c\udf7d\ufe0f",title:"Sell or Dine",description:"discard food for money or fulfil an order",type:1,cost:4,activate:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];var t=this;return e.selectAction([{icon:"\ud83c\udf7d\ufe0f",action:function(){return k[6].activate(e).catch((function(n){return alert(n),t.activate(e)}))}},{icon:"\ud83e\udd61",action:function(){return k[3].activate(e).catch((function(n){return alert(n),t.activate(e)}))}}])}},{icon:"\ud83e\udd61\ud83e\udd61",title:"Sell 2 food",description:"sell 2 food",type:1,cost:3,activate:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return w(e,n).then((function(){return w(e,n)})).catch((function(n){return t.activate(e)}))}}],k=[{icon:"\ud83c\udf63",title:"Sushi",description:"Cook some sushi",type:0,cost:0,activate:E("sushi")},{icon:"\ud83c\udf5c",title:"Noodles",description:"Cook some noodles",type:0,cost:0,activate:E("noodles")},{icon:"\ud83c\udf75",title:"Tea",description:"Produce some tea",type:0,cost:0,activate:E("tea")},{icon:"\ud83e\udd61",title:"Takeout",description:"Sell food for money",type:0,cost:0,activate:function(e){var t,n=this,r=arguments;return f.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:if(t=r.length>1&&void 0!==r[1]?r[1]:1,e.hasAnyFood()){o.next=3;break}throw new Error("no food to sell");case 3:return o.abrupt("return",e.selectFood().then((function(r){var o=r.foodType,c=r.amount;return e.loseFood(o,c).then((function(){return e.gainMoney(c*t)})).catch((function(t){return alert(t),n.activate(e)}))})));case 4:case"end":return o.stop()}}))}},{icon:"\ud83d\udc69\u200d\ud83c\udf73",title:"Hire",description:"Hire a worker (new meeple)",type:0,cost:0,activate:function(e,t){return f.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}))}},{icon:"\ud83d\udee0\ufe0f",title:"Improve",description:"Improve your restaurant (buy tiles)",type:0,cost:0,activate:function(e,t){var n=this;return f.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:if(S.map((function(t){return e.currentMoney()>=t.cost})).some((function(e){return!0===e}))){t.next=3;break}throw new Error("cannot afford any tiles");case 3:return t.abrupt("return",e.selectTile().then((function(t){return e.loseMoney(t.cost).then((function(){return e.placeTile(t)}),(function(t){return alert(t),n.activate(e)}))})));case 4:case"end":return t.stop()}}))}},{icon:"\ud83c\udf7d\ufe0f",title:"Dining",description:"Fulfil an order",type:0,cost:0,activate:function(e){var t=this,n=arguments;return f.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:if(n.length>1&&void 0!==n[1]?n[1]:1,y.currentOrders().map((function(t){return b(e.currentFood(),t)})).some((function(e){return!0===e}))){r.next=4;break}throw new Error("Cannot fulfil any orders right now");case 4:return r.abrupt("return",e.selectOrder().then((function(t){return e.fulfilOrder(t)}),alert).catch((function(n){return alert(n),t.activate(e)})));case 5:case"end":return r.stop()}}))}},{icon:"\ud83e\udde9",name:"Rearrange",text:"Rearrange tiles on your board",type:0,cost:0,activate:function(e,t){}}],j=k,F="food",x="tile",M="position",T="order",A="action",P=function(){var e=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8,t=Array.from(new Array(e),(function(e,t){return t})),n=[],r=0;r<e;r+=1){var o=Math.floor(Math.random()*t.length),c=t.splice(o,1)[0];n.push(c)}return n}(j.length).map((function(e,t){return Object(s.a)({},j[e],{position:t})}));return e.x=O,e},C=function(e,t,n){var r=P(),o={},c={sushi:0,noodles:0,tea:0},a=0,i=0,l=0,d=0,p=null,v=function(){},h=function(){},m=null,y=function(e,t){return new Promise((function(n,r){p=e,v({type:e,options:t}),m=function(e){return p=null,m=null,v(null),n(e)}}))};return{onSetState:function(e){v=e},gainMoney:function(e){l+=e},loseMoney:function(e){return f.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(l<e)){t.next=2;break}throw new Error("Not enough money");case 2:l-=e;case 3:case"end":return t.stop()}}))},gainPoints:function(e){d+=e},gainFood:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];c[e]||(c[e]=0),n&&o.gainFood&&o.gainFood.call(this,e,t),c[e]+=t,a+=t},loseFood:function(e,t){return f.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:if(c[e]&&!(c[e]<t)){n.next=2;break}throw new Error("Not enough ".concat(e));case 2:c[e]-=t,a-=t;case 4:case"end":return n.stop()}}))},hasAnyFood:function(){return a>0},selectFood:function(){return y(F)},currentMoney:function(){return l},currentScore:function(){return d},currentFood:function(){return Object(s.a)({},c)},currentBoard:function(){return r},currentPosition:function(){return i},onMove:function(e){h=e},move:function(e){var t=this;if(p)throw new Error("select ".concat(p," first"));if(i<6&&i<e&&e-i<=2||6===i&&(7===e||0===e)||7===i&&(0===e||1===e))return i=e,Promise.resolve().then((function(){return r[e].activate(t)})).finally(h);throw new Error("Illigal move")},selectOrder:function(){return f.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",y(T));case 1:case"end":return e.stop()}}))},fulfilOrder:function(e){var n,r=this;return f.a.async((function(o){for(;;)switch(o.prev=o.next){case 0:if(n=Object.entries(e.foods),b(c,e)){o.next=4;break}throw p=null,new Error("Cannot fulfil order");case 4:n.forEach((function(e){var t=Object(u.a)(e,2),n=t[0],o=t[1];r.loseFood(n,o)})),t.discardOrder(e.id),this.gainPoints(e.points),this.gainMoney(e.money),p=null;case 9:case"end":return o.stop()}}),null,this)},selectTile:function(){return f.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",y(x));case 1:case"end":return e.stop()}}))},placeTile:function(e){return f.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",y(M).then((function(t){r[t]=Object(s.a)({},e,{position:t}),v(void 0)})));case 1:case"end":return t.stop()}}))},uiSelection:function(e,t){return m(t)},selectAction:function(e){return y(A,e)}}},N=(n(15),function(e){return o.a.createElement("table",{class:"player-board"},function(e){return[[e[0],e[1],e[2]],[e[7],e.x,e[3]],[e[6],e[5],e[4]]]}(e.player.currentBoard()).map((function(t){return o.a.createElement("tr",null,t.map((function(t){return o.a.createElement("td",{class:"board-tile",onClick:function(){return Promise.resolve().then((function(){return e.onPlaceTile?e.onPlaceTile(t.position):e.player.move(t.position)})).catch(alert)}},t.icon," ",e.player.currentPosition()===t.position?"\u265f\ufe0f":"",o.a.createElement("div",{class:"tooltip"},t.description))})))})))}),B={money:{symbol:"\ud83d\udcb8"},points:{symbol:"\u2b50"},sushi:{symbol:"\ud83c\udf63",type:"food"},noodles:{symbol:"\ud83c\udf5c",type:"food"},tea:{symbol:"\ud83c\udf75",type:"food"}},I=function(e){var t=Object.entries(Object(s.a)({money:e.player.currentMoney(),points:e.player.currentScore()},e.player.currentFood())).reduce((function(t,n){var r=Object(u.a)(n,2),c=r[0],a=r[1];t[a]||(t[a]=[]);var i="food"===B[c].type?o.a.createElement("div",{onClick:function(){return e.onSelectFood&&e.onSelectFood({foodType:c,amount:1})}},B[c].symbol):o.a.createElement("div",null,B[c].symbol);return t[a].push(i),t}),Array.from(new Array(11)));return o.a.createElement("table",{class:"player-stats"},o.a.createElement("tr",null,Object.keys(t).map((function(e){return o.a.createElement("td",null,t[e]||[])}))),o.a.createElement("tr",null,Object.keys(t).map((function(e){return o.a.createElement("td",null,e)}))))},R=y,D=C("p1",R,S),H=function(e){var t=e.id,n=e.foods,r=e.points,c=e.onSelect,a=e.money;return o.a.createElement("div",{class:"order",onClick:function(){return c&&c({id:t,foods:n,points:r,money:a})}},Object.entries(n).map((function(e){var t=Object(u.a)(e,2),n=t[0],r=t[1];return o.a.createElement("span",null,r," ",B[n].symbol)})),o.a.createElement("hr",null),o.a.createElement("div",null,r," ",B.points.symbol,"  ",a," ",B.money.symbol))},J=function(e){return o.a.createElement("div",null,e.orders.map((function(t){return o.a.createElement(H,Object.assign({},t,{onSelect:e.onSelectOrder}))})))},W=function(e){var t=e.icon,n=e.cost,r=e.description,c=e.onSelect,a=Object(i.a)(e,["icon","cost","description","onSelect"]);return o.a.createElement("td",{class:"market-tile",onClick:function(){return c&&c(Object(s.a)({icon:t,cost:n},a))}},t,o.a.createElement("hr",null),o.a.createElement("div",null,"cost: ",n,"\ud83d\udcb8"),o.a.createElement("div",{class:"tooltip"},r))},$=function(e){var t=e.onSelect;return o.a.createElement("table",{className:"player-board small-font"},o.a.createElement("tr",null,S.map((function(e){return o.a.createElement(W,Object.assign({},e,{onSelect:t}))}))))},q=function(e){var t=e.options,n=e.forceRefresh;return t&&o.a.createElement("div",{class:"action-options"},t.map((function(e){return o.a.createElement("div",{class:"action-option",onClick:function(){return e.action().then(n)}},e.icon)})))};var z=function(){var e=o.a.useState(0),t=Object(u.a)(e,2),n=t[0],c=t[1],a=o.a.useState(0),i=Object(u.a)(a,2),s=(i[0],i[1]),l=o.a.useState(null),f=Object(u.a)(l,2),d=f[0],p=f[1],v=o.a.useState(null),h=Object(u.a)(v,2),m=h[0],y=h[1],b=function(e){return d&&d===e?function(t){return D.uiSelection(e,t)}:null};return Object(r.useEffect)((function(){D.onMove((function(){return c((function(e){return e+1}))})),D.onSetState((function(e){var t=e||{},n=t.type,r=void 0===n?null:n,o=t.options,c=void 0===o?null:o;p(r),y(c)}))}),[]),o.a.createElement("div",{class:"wrapper"},o.a.createElement("div",null,"Turn: ",n," ",d?"Select ".concat(d):""),o.a.createElement(q,{options:m,forceRefresh:function(){return s((function(e){return e+1}))}}),o.a.createElement("div",{class:"float-left"},o.a.createElement(N,{player:D,onPlaceTile:b(M)}),o.a.createElement(I,{player:D,onSelectFood:b(F)})),o.a.createElement("div",{class:"float-right"},o.a.createElement(J,{orders:R.currentOrders(),onSelectOrder:b(T)}),o.a.createElement($,{onSelect:b(x)})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a.a.render(o.a.createElement(z,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))},8:function(e,t,n){e.exports=n(16)}},[[8,1,2]]]);
//# sourceMappingURL=main.877799c2.chunk.js.map